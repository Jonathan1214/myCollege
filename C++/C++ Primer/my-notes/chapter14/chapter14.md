# 第十四章 重载运算

[返回总目录](../../README.md)

+ [14.1 基本概念](#14.1-基本概念)
+ [14.2 输入和输出运算符](#14.2-输入和输出运算符)
+ [14.3 算术和关系运算符](#14.3-算术和关系运算符)
+ [14.4 赋值运算符](#14.4-赋值运算符)
+ [14.5 下标运算符](#14.5-下标运算符)
+ [14.6 递增和递减运算符](#14.6-递增和递减运算符)
+ [14.7 成员访问运算符](#14.7-成员访问运算符)
+ [14.8 函数调用运算符](#14.8-函数调用运算符)
+ [14.9 重载、类型转换与运算符](#14.9-重载、类型转换与运算符)

当运算符作用于类类型的运算对象时，可以通过重载运算符重新定义运算符的含义。

## 14.1 基本概念

重载运算符的名字：operator 和其后要定义的运算符号共同组成。和其他函数一样，重载的运算符也包含返回类型、参数列表以及函数体。

参数数量与运算符作用的运算对象数量一样多。对二元运算符而言，左侧运算对象传递给第一个参数，右侧运算对象传递给第二个参数。

如果一个运算符函数是成员函数，那么第一个参数绑定到隐式的 this 指针上。

对一个运算符函数而言，它或者是类的成员，或者至少含有一个类类型的参数。

只能重载已有运算符而不能创造新的运算符。

### 直接调用一个重载的运算符函数

### 某些运输符不应该被重载

### 使用与内置运算符一致的含义

### 赋值和复合赋值运算符

### 选择作为成员或者非成员

当我们定义重载的运算符时，必须首先确定将其声明为类的成员函数还是声明为一个普通的非成员函数。

+ 赋值（=）、下标（[]）、调用（()）和成员访问箭头（->）运算符必须是成员。
+ 符合赋值运算符一般而言应该是成员，但并非必须
+ 改变对象的状态的运算符或者与给定类型密切相关的运算符，如递增、递减和解引用运算符，通常应该是成员。
+ 具有对称性的运算符可能转换任意一端的运算对象，例如算术、相等性、关系和位运算符等，因此它们通常应该是普通的非成员函数。

## 14.2 输入和输出运算符

### 14.2.1 重载输出运算符 <<

通常，输出运算符的第一个形参是一个非常量的 ostream 对象的引用。第二个形参是常量的引用。

#### 输出运算符尽量减少格式化操作

如增加换行符。

#### 输出输入运算符必须是非成员函数

### 14.2.2 重载输入运算符 >>

通常，输入运算符第一个参数是运算符将要读取的流的引用，第二个形参是将要读入到的（非常量）对象的引用。

输入运算符必须处理可能失败的情况，而输出运算符不需要。

#### 输入时的错误

#### 标示错误

## 14.3 算术和关系运算符

如果类同时定义了算术运算符和赋值运算符，应该使用复合赋值来实现算术运算符。

### 14.3.1 相等运算符

### 14.3.2 关系运算符

## 14.4 赋值运算符

赋值运算符需定义为成员函数。

### 复合赋值运算符

必须定义成类的成员。

## 14.5 下标运算符

必须是成员函数。

通常有两个版本，一个返回普通引用，一个是类的常量成员并且返回常量引用。

## 14.6 递增和递减运算符

通常应该定义前置版本和后置版本，且定义成类的成员。

### 区分前置和后置

后置版本接受一个额外的不被使用的 int 形参。

对后置版本而言，递增前先要记录对象的状态。

### 显示的调用后置运算符

```C++
p.operator(0);  // 后置
p.operator();   // 前置
```

## 14.7 成员访问运算符

箭头运算符必须是类的成员，解引用运算符通常也是类的成员。

### 对箭头运算符返回值的限定

## 14.8 函数调用运算符

必须是成员函数。

### 含有状态的函数对象类

### 14.8.1 lambda 是函数对象

### 14.8.2 标准库定义的函数对象

### 14.8.3 可调用的对象与 function

## 14.9 重载、类型转换与运算符

转换构造函数和类型转换运算符共同定义了 **类类型转换**。

### 14.9.1 类类型转换运算符

类的特殊成员函数，一般定义成如下形式：

operator type() const;

没有显示的返回类型，没有形参。

#### 类类型转换运算符可能产生意外的结果

#### 显示的类类型转换运算符

声明为 explicit

#### 转换为 bool

### 14.9.2 避免有二义性的类型转换

### 14.9.3 函数匹配与重载运算符
